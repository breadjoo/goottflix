<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.goottflix.chat.entity.mapper.ChatRoomMapper">


    <!-- 채팅방 생성 -->
    <insert id="createChatRoom" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO chatroom (user_id_1, user_id_2, created_at)
        VALUES (#{userId1}, #{userId2}, NOW())
    </insert>

    <!-- 특정 유저 간 채팅방 조회 -->
    <select id="findChatRoom" resultType="com.goottflix.chat.entity.ChatRoomDTO">
        SELECT * FROM chatroom
        WHERE (user_id_1 = #{userId1} AND user_id_2 = #{userId2})
           OR (user_id_1 = #{userId2} AND user_id_2 = #{userId1})
    </select>

    <!-- 모든 채팅방 조회 (디버깅용) -->
    <select id="findAllChatRooms" resultType="com.goottflix.chat.entity.ChatRoomDTO">
        SELECT * FROM chatroom
    </select>

</mapper>